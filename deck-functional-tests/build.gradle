import groovy.json.JsonSlurper

buildscript {
  repositories {
    jcenter()
    maven { url "http://dl.bintray.com/spinnaker/gradle" }
    maven { url "https://plugins.gradle.org/m2/" }
  }
  dependencies {
    classpath 'com.moowork.gradle:gradle-node-plugin:1.1.1'
  }
}

group = "com.netflix.spinnaker.deck-functional-tests"

apply plugin: 'com.moowork.node'

node {
    // Pulls node and npm versions from package.json.
    def packageSlurper = new JsonSlurper()
    def packageJson = packageSlurper.parse file('package.json')

    version = packageJson.engines.node.replaceAll(/[^\d\.]/, '')
    npmVersion = packageJson.engines.npm.replaceAll(/[^\d\.]/, '')
    yarnVersion = packageJson.engines.yarn.replaceAll(/[^\d\.]/, '')

    // Enabled the automatic download. False is the default (for now).
    download = true
}

task test(type: YarnTask) {
  args = ["test", "--replay-network", "--serve-static", "../deck/build/webpack/"]
}

test.dependsOn 'yarn'
